(this.webpackJsonppuissance4=this.webpackJsonppuissance4||[]).push([[0],{127:function(e,t){},130:function(e,t,n){},131:function(e,t,n){},132:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},137:function(e,t,n){},138:function(e,t,n){},139:function(e,t,n){},140:function(e,t,n){},141:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(24),u=n.n(c),o=n(16),i=n(3),s=(n(80),n(8)),l=n(9),p=n(10),f=n(11),E=n(15),m=n(38),d=n.n(m),v=n(65),O=n(2),h=n(66),T=n.n(h),b=n(14),S=n.n(b),g=n(28),N=(n(130),function(e){var t=e.handleChange,n=e.label,r=Object(g.a)(e,["handleChange","label"]);return a.a.createElement("div",{className:"group"},a.a.createElement("input",Object.assign({className:"form-input",type:"text"},r,{onChange:t})),n?a.a.createElement("label",{className:"".concat(r.value.length?"shrink":""," form-input-label")},n):null)}),y=(n(131),function(e){var t=e.children,n=Object(g.a)(e,["children"]);return a.a.createElement("button",Object.assign({className:"custom-button"},n),t)}),U={apiEndPoint:"https://puissance4-server.herokuapp.com/"},_=(n(132),n(67)),C=n.n(_),j={SET_CURRENT_USER:"SET_CURRENT_USER",SET_CONNECTED_USERS:"SET_CONNECTED_USERS",SET_REGISTRATION_SOCKET:"SET_REGISTRATION_SOCKET",SET_INVITED:"SET_INVITED",TOGGLE_TURN:"TOGGLE_TURN",SET_TURN:"SET_TURN"},R=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleChange=function(e){var t=e.target.value;r.setState((function(e){return Object(O.a)({},e,{error:"",input:t})}))},r.handleSubmit=function(){var e=Object(v.a)(d.a.mark((function e(t){var n,a,c,u,o,i,s,l,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.state.input,a=r.props,c=a.setCurrentUser,u=a.setConnectedUsers,o=a.history,i=a.setRegistrationSocket,s={name:n},t.preventDefault(),e.prev=4,l="".concat(U.apiEndPoint,"api/users/exists/"),e.next=8,T()(l,{method:"POST",headers:{"content-type":"application/json"},data:{user:s}});case 8:c(n),p=S()("".concat(U.apiEndPoint,"register")),i(p),p.on("connectedUsers",(function(e){u(e)})),o.push("/users"),p.emit("registerInfos",{username:n}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),r.setState((function(t){return Object(O.a)({},t,{error:e.t0})}));case 19:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t){return e.apply(this,arguments)}}(),r.state={input:"",error:""},r}return Object(l.a)(n,[{key:"render",value:function(){var e=this.state,t=e.input,n=e.error;return a.a.createElement("div",{className:"login"},a.a.createElement("form",{className:"login-form",onSubmit:this.handleSubmit},a.a.createElement("img",{src:C.a,alt:"logo"}),a.a.createElement(N,{value:t,type:"text",handleChange:this.handleChange,label:"Name",required:!0}),a.a.createElement(y,{type:"submit"},"Validate"),n?a.a.createElement("div",{className:"error"},"Username already exists"):null))}}]),n}(a.a.Component),k=Object(i.b)(null,(function(e){return{setCurrentUser:function(t){return e(function(e){return{type:j.SET_CURRENT_USER,payload:e}}(t))},setConnectedUsers:function(t){return e(function(e){return{type:j.SET_CONNECTED_USERS,payload:e}}(t))},setRegistrationSocket:function(t){return e(function(e){return{type:j.SET_REGISTRATION_SOCKET,payload:e}}(t))}}}))(Object(E.e)(R)),I=(n(134),n(135),n(136),function(e){var t=e.bg,n=e.opac;return a.a.createElement("div",{className:"cell",style:{backgroundColor:t,border:n?"1px solid red":"0",transition:"all 0.5s ease"}})}),x=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).setHover=function(){r.props.turn&&r.setState((function(e){return Object(O.a)({},e,{hoverColor:!0})}))},r.setOut=function(){r.props.turn&&r.setState((function(e){return Object(O.a)({},e,{hoverColor:!1})}))},r.handleClick=function(e){if(r.props.turn){var t=r.props,n=t.gameSocket,a=t.currentUser,c=t.currentOpponent,u=t.invited;n.emit("newAction",{x:e,player:a,player1:u?c:a,player2:u?a:c})}},r.state={hoverColor:!1},r}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.index,r=t.currentColumn,c=t.turn;return a.a.createElement("div",{className:"column",onClick:function(){return e.handleClick(n)},onMouseOver:this.setHover,onMouseOut:this.setOut},function(e){for(var t=[],u=0;u<6;u++)t.push(a.a.createElement(I,{key:u,bg:A(r(n)[u]),opac:e.hoverColor&&-1===r(n)[u]&&c}));return t}(this.state))}}]),n}(a.a.Component),A=function(e){return 1===e?"red":2===e?"yellow":"white"},M=Object(i.b)((function(e){return{currentColumn:function(t){return e.game.currentMatrix[t]},currentUser:e.user.currentUser,currentOpponent:e.opponent.currentOpponent,invited:e.user.invited,turn:e.user.turn}}))(x),w={ADD_VALUE_TO_COLUMN:"ADD_VALUE_TO_COLUMN",INITIALIZE_MATRIX:"INITIALIZE_MATRIX"},D=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={gameSocket:{},win:!1,lose:!1,x:null},r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.currentUser,r=t.currentOpponent,a=t.registrationSocket,c=t.invited,u=t.addCell,o=t.setTurn,i=t.toggleTurn,s=t.history,l=t.initializeMatrix;a.socket&&a.close(),r||n||s.push("/");var p=S()("".concat(U.apiEndPoint,"game"));this.setState((function(e){return Object(O.a)({},e,{gameSocket:p})})),p.emit("startGame",c?{player1:r,player2:n}:{player1:n,player2:r}),o(!c),p.on("newAction",(function(t){var r=t.x,a=t.player;u(a===n?1:2,r),i();var c=e.props.currentMatrix;e.verifyWin(c,r)&&(alert("You ".concat(a===n?"win":"lose")),l())}))}},{key:"componentDidUpdate",value:function(e,t,n){}},{key:"verifyWin",value:function(e,t){var n=e[t].indexOf(-1),r=-1!==n?n-1:5,a=function(e,t,n){for(var r=e[t][n],a=0,c=-1;t+a<7&&e[t+a][n]===r;)a++;for(;t+c>=0&&e[t+c][n]===r;)c--;return a-c-1}(e,t,r)>=4,c=function(e,t,n){for(var r=e[t][n],a=0;n+a>=0&&e[t][n+a]===r;)a--;return-a}(e,t,r)>=4,u=function(e,t,n){for(var r=e[t][n],a=0,c=-1;t+a<7&&n+a<6&&e[t+a][n+a]===r;)a++;for(;t+c>=0&&n+c>=0&&e[t+c][n+c]===r;)c--;return a-c-1}(e,t,r)>=4,o=function(e,t,n){for(var r=e[t][n],a=-1,c=0;t+a>=0&&n-a<6&&e[t+a][n-a]===r;)a--;for(;t+c<7&&n-c>=0&&e[t+c][n-c]===r;)c++;return c-a-1}(e,t,r)>=4;return a||c||u||o}},{key:"render",value:function(){return a.a.createElement("div",{className:"gamePage"},a.a.createElement("h1",null,a.a.createElement("span",{className:this.props.turn?"turn":""},"You")," VS ",a.a.createElement("span",{className:this.props.turn?"":"turn"},this.props.currentOpponent)),a.a.createElement("div",{className:"gameMatrix"},a.a.createElement("div",{className:"content"},function(e){for(var t=[],n=0;n<7;n++)t.push(a.a.createElement(M,{key:n,index:n,gameSocket:e.gameSocket}));return t}(this.state))))}}]),n}(a.a.Component),L=Object(i.b)((function(e){return{currentUser:e.user.currentUser,registrationSocket:e.user.registrationSocket,currentOpponent:e.opponent.currentOpponent,invited:e.user.invited,currentMatrix:e.game.currentMatrix,turn:e.user.turn}}),(function(e){return{addCell:function(t,n){return e(function(e,t){return{type:w.ADD_VALUE_TO_COLUMN,payload:{value:e,columnIndex:t}}}(t,n))},setTurn:function(t){return e(function(e){return{type:j.SET_TURN,payload:e}}(t))},toggleTurn:function(){return e({type:j.TOGGLE_TURN})},initializeMatrix:function(){return e({type:w.INITIALIZE_MATRIX})}}}))(Object(E.e)(D)),P=(n(137),n(138),n(139),{SET_CURRENT_OPPONENT:"SET_CURRENT_OPPONENT"}),G=function(e){return{type:P.SET_CURRENT_OPPONENT,payload:e}},V=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleClick=function(e){var t=r.props,n=t.currentUser,a=t.history,c=t.setCurrentOpponent,u=S()("".concat(U.apiEndPoint,"invite")),o=e.target.innerHTML;u.on("confirmed",(function(){c(o),u.close(),a.push("/game")})),u.emit("invite",{src:n,to:o}),r.setState({waiting:!0})},r.state={waiting:!1},r}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.name,t=this.state.waiting;return a.a.createElement("li",{onClick:this.handleClick},a.a.createElement("b",null,e),t?a.a.createElement("span",{style:{marginLeft:"3px"}},"Waiting for confirmation !!"):null)}}]),n}(a.a.Component),K=Object(i.b)((function(e){return{registrationSocket:e.user.registrationSocket,currentUser:e.user.currentUser}}),(function(e){return{setCurrentOpponent:function(t){return e(G(t))}}}))(Object(E.e)(V)),W=Object(i.b)((function(e){return{currentUser:e.user.currentUser,connectedUsers:e.user.connectedUsers}}))((function(e){var t=e.currentUser,n=e.connectedUsers;return a.a.createElement("div",null,1===n.length?a.a.createElement("div",null,"No User Connected !"):null,a.a.createElement("ul",null,n.map((function(e,n){return e!==t?a.a.createElement(K,{name:e,key:n}):null}))))})),X=Object(i.b)((function(e){return{currentUser:e.user.currentUser,registrationSocket:e.user.registrationSocket}}),(function(e){return{setCurrentOpponent:function(t){return e(G(t))},setInvited:function(){return e({type:j.SET_INVITED})}}}))(Object(E.e)((function(e){var t=e.currentUser,n=e.registrationSocket,r=e.history,c=e.setCurrentOpponent,u=e.setInvited;return n.on("newInvitation",(function(e){window.confirm("You have received a new invitation from "+e)&&(c(e),u(),S()("".concat(U.apiEndPoint,"invite")).emit("confirm",{src:e,to:t}),r.push("/game"))})),a.a.createElement("div",null,a.a.createElement("h1",null,"Welcome ",t),a.a.createElement("span",null,a.a.createElement("i",null,"Select a user to send invitation !")),a.a.createElement(W,null))}))),Z=(n(140),function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={messages:[]},r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(E.a,{exact:!0,path:"/",component:k}),a.a.createElement(E.a,{path:"/game",component:L}),a.a.createElement(E.a,{path:"/users",component:X}))}}]),n}(a.a.Component)),H=n(17),Y=n(69),z={currentUser:"",connectedUsers:[],registrationSocket:{},invited:!1,turn:!1},J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j.SET_CURRENT_USER:return Object(O.a)({},e,{currentUser:t.payload});case j.SET_CONNECTED_USERS:return Object(O.a)({},e,{connectedUsers:t.payload});case j.SET_REGISTRATION_SOCKET:return Object(O.a)({},e,{registrationSocket:t.payload});case j.SET_INVITED:return Object(O.a)({},e,{invited:!0});case j.TOGGLE_TURN:return Object(O.a)({},e,{turn:!e.turn});case j.SET_TURN:return Object(O.a)({},e,{turn:t.payload});default:return e}},q={currentOpponent:""},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P.SET_CURRENT_OPPONENT:return Object(O.a)({},e,{currentOpponent:t.payload});default:return e}},F=n(70),Q=[-1,0,0,0,0,0],$={currentMatrix:function(){for(var e=[],t=0;t<7;t++)e[t]=Object(F.a)(Array,Q);return e}()},ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w.ADD_VALUE_TO_COLUMN:var n=t.payload,r=n.columnIndex,a=n.value,c=e.currentMatrix.map((function(e){return e.slice()})),u=c[r].indexOf(-1);return u>=0&&(c[r][u]=a),u<5&&u>=0&&(c[r][u+1]=-1),Object(O.a)({},e,{currentMatrix:c});case w.INITIALIZE_MATRIX:return $;default:return e}},te=Object(H.c)({user:J,opponent:B,game:ee}),ne=[Y.logger],re=Object(H.d)(te,H.a.apply(void 0,ne));u.a.render(a.a.createElement(i.a,{store:re},a.a.createElement(o.a,null,a.a.createElement(Z,null))),document.getElementById("root"))},67:function(e,t,n){e.exports=n.p+"static/media/favicon.4a7baa99.png"},71:function(e,t,n){e.exports=n(141)},80:function(e,t,n){}},[[71,1,2]]]);
//# sourceMappingURL=main.4280e681.chunk.js.map